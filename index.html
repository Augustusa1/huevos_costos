<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Costos Logísticos de Huevos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        .kpi-table {
            min-width: 1000px;
        }
        .chart-container {
            position: relative;
            margin: auto;
            height: 70vh;
            width: 90vw;
            max-width: 1200px;
        }
        .tab-button {
            transition: all 0.3s ease-in-out;
        }
        .tab-button.active {
            border-bottom-width: 4px;
            font-weight: 700;
        }
    </style>
</head>
<body class="text-gray-800">

    <div class="container mx-auto p-4 sm:p-8">
        <header class="text-center mb-6">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Análisis Costos Logísticos de Huevos</h1>
            <p class="text-lg text-gray-600 mt-2">Análisis de KPIs por Departamento</p>
        </header>

        <!-- Pestañas de Navegación -->
        <div class="border-b border-gray-200 mb-8">
            <nav class="-mb-px flex justify-center space-x-4 sm:space-x-8" aria-label="Tabs">
                <button id="tab-nacional" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-red-500 text-red-600 active" data-view="nacional-view">
                    Nacional
                </button>
                <button id="tab-scz" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-green-600 hover:border-green-300" data-view="scz-view">
                    Santa Cruz
                </button>
                <button id="tab-lpz" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-rose-600 hover:border-rose-300" data-view="lpz-view">
                    La Paz
                </button>
                <button id="tab-cbba" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg border-transparent text-gray-500 hover:text-blue-600 hover:border-blue-300" data-view="cbba-view">
                    Cochabamba
                </button>
            </nav>
        </div>
        
        <!-- Botón global para plegar/desplegar -->
        <div class="text-center mb-8">
            <button id="toggle-all-button" class="bg-gray-700 text-white font-bold py-2 px-5 rounded-lg hover:bg-gray-800 transition-colors shadow-md">
                Ocultar Detalles
            </button>
        </div>

        <!-- Vista Nacional -->
        <div id="nacional-view" class="view-container space-y-12">
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-red-200">
                <h2 class="text-2xl font-bold text-red-700 mb-6 text-center">Costos por Kilogramo (Bs/Kg)</h2>
                <div class="overflow-x-auto">
                    <div id="table-container-kg-nacional"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-red-200">
                <h2 class="text-2xl font-bold text-red-700 mb-6 text-center">Costos por Maple (Bs/Maple)</h2>
                <div class="overflow-x-auto">
                    <div id="table-container-maple-nacional"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-red-200">
                <h2 class="text-2xl font-bold text-red-700 mb-6 text-center">Análisis Pareto de Cuentas de Transporte Nacional</h2>
                <div class="chart-container">
                    <canvas id="paretoChartTransporte"></canvas>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-red-200">
                <h2 class="text-2xl font-bold text-red-700 mb-6 text-center">Análisis Pareto de Cuentas de Almacenamiento Nacional</h2>
                <div class="chart-container">
                    <canvas id="paretoChartAlmacenamiento"></canvas>
                </div>
            </section>
        </div>

        <!-- Vista Santa Cruz -->
        <div id="scz-view" class="view-container space-y-12 hidden">
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-green-200">
                <h2 class="text-2xl font-bold text-green-700 mb-2 text-center">Costos por Kilogramo (Bs/Kg)</h2>
                 <p class="text-md text-green-600 text-center mb-6">Análisis de Costos y Ruta SCZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-kg-scz"></div>
                </div>
                 <div class="chart-container mt-8">
                    <canvas id="simulationChartScz"></canvas>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-green-200">
                <h2 class="text-2xl font-bold text-green-700 mb-2 text-center">Costos por Maple (Bs/Maple)</h2>
                 <p class="text-md text-green-600 text-center mb-6">Análisis de Costos y Ruta SCZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-maple-scz"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-green-200">
                <h2 class="text-2xl font-bold text-green-700 mb-2 text-center">Análisis de Transporte</h2>
                 <p class="text-md text-green-600 text-center mb-6">Análisis de Costos y Ruta SCZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-transporte-scz"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-green-200">
                <h2 class="text-2xl font-bold text-green-700 mb-2 text-center">Análisis por Canal</h2>
                 <p class="text-md text-green-600 text-center mb-6">Análisis de Costos y Ruta SCZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-canal-scz"></div>
                </div>
            </section>
        </div>

        <!-- Vista La Paz -->
        <div id="lpz-view" class="view-container space-y-12 hidden">
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-rose-200">
                <h2 class="text-2xl font-bold text-rose-700 mb-2 text-center">Costos por Kilogramo (Bs/Kg)</h2>
                <p class="text-md text-rose-600 text-center mb-6">Análisis de Costos y Ruta LPZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-kg-lpz"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-rose-200">
                <h2 class="text-2xl font-bold text-rose-700 mb-2 text-center">Costos por Maple (Bs/Maple)</h2>
                <p class="text-md text-rose-600 text-center mb-6">Análisis de Costos y Ruta LPZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-maple-lpz"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-rose-200">
                <h2 class="text-2xl font-bold text-rose-700 mb-2 text-center">Análisis de Transporte</h2>
                <p class="text-md text-rose-600 text-center mb-6">Análisis de Costos y Ruta LPZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-transporte-lpz"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-rose-200">
                <h2 class="text-2xl font-bold text-rose-700 mb-2 text-center">Análisis por Canal</h2>
                <p class="text-md text-rose-600 text-center mb-6">Análisis de Costos y Ruta LPZ</p>
                <div class="overflow-x-auto">
                    <div id="table-container-canal-lpz"></div>
                </div>
            </section>
        </div>
        
        <!-- Vista Cochabamba -->
        <div id="cbba-view" class="view-container space-y-12 hidden">
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-blue-200">
                <h2 class="text-2xl font-bold text-blue-700 mb-2 text-center">Costos por Kilogramo (Bs/Kg)</h2>
                <p class="text-md text-blue-600 text-center mb-6">Análisis de Costos y Ruta CBBA</p>
                <div class="overflow-x-auto">
                    <div id="table-container-kg-cbba"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-blue-200">
                <h2 class="text-2xl font-bold text-blue-700 mb-2 text-center">Costos por Maple (Bs/Maple)</h2>
                <p class="text-md text-blue-600 text-center mb-6">Análisis de Costos y Ruta CBBA</p>
                <div class="overflow-x-auto">
                    <div id="table-container-maple-cbba"></div>
                </div>
            </section>
             <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-blue-200">
                <h2 class="text-2xl font-bold text-blue-700 mb-2 text-center">Análisis de Transporte</h2>
                <p class="text-md text-blue-600 text-center mb-6">Análisis de Costos y Ruta CBBA</p>
                <div class="overflow-x-auto">
                    <div id="table-container-transporte-cbba"></div>
                </div>
            </section>
            <section class="bg-white p-4 sm:p-6 rounded-xl shadow-lg border border-blue-200">
                <h2 class="text-2xl font-bold text-blue-700 mb-2 text-center">Análisis por Canal</h2>
                <p class="text-md text-blue-600 text-center mb-6">Análisis de Costos y Ruta CBBA</p>
                <div class="overflow-x-auto">
                    <div id="table-container-canal-cbba"></div>
                </div>
            </section>
        </div>

    </div>

    <script>
        // --- 1. DATOS ---
        const datosNacional = {
            logistica: [
                { mes: 'jul. 2024', transp_kg: 0.42, alm_kg: 0.17, transp_maple: 0.74, alm_maple: 0.30 }, { mes: 'ago. 2024', transp_kg: 0.48, alm_kg: 0.21, transp_maple: 0.86, alm_maple: 0.37 }, { mes: 'sep. 2024', transp_kg: 0.45, alm_kg: 0.22, transp_maple: 0.81, alm_maple: 0.40 }, { mes: 'oct. 2024', transp_kg: 0.48, alm_kg: 0.20, transp_maple: 0.88, alm_maple: 0.37 }, { mes: 'nov. 2024', transp_kg: 0.31, alm_kg: 0.15, transp_maple: 0.57, alm_maple: 0.27 }, { mes: 'dic. 2024', transp_kg: 0.46, alm_kg: 0.27, transp_maple: 0.84, alm_maple: 0.49 }, { mes: 'ene. 2025', transp_kg: 0.43, alm_kg: 0.19, transp_maple: 0.77, alm_maple: 0.35 }, { mes: 'feb. 2025', transp_kg: 0.43, alm_kg: 0.20, transp_maple: 0.80, alm_maple: 0.36 }, { mes: 'mar. 2025', transp_kg: 0.38, alm_kg: 0.26, transp_maple: 0.70, alm_maple: 0.48 }, { mes: 'abr. 2025', transp_kg: 0.38, alm_kg: 0.22, transp_maple: 0.70, alm_maple: 0.40 }, { mes: 'may. 2025', transp_kg: 0.36, alm_kg: 0.24, transp_maple: 0.64, alm_maple: 0.44 }, { mes: 'jun. 2025', transp_kg: 0.42, alm_kg: 0.38, transp_maple: 0.76, alm_maple: 0.68 },
            ],
            cuentasTransporte: [
                { cuenta: 'Sueldos Y Jornales', valor: 10832 }, { cuenta: 'Sistemas tecnologicos', valor: 1993 }, { cuenta: 'Servicios Externos', valor: 1063 }, { cuenta: 'Seguros Gral, Fletes De Producto', valor: 163462 }, { cuenta: 'Ropa De Trabajo', valor: 24 }, { cuenta: 'Pasajes Y Viaticos', valor: 294 }, { cuenta: 'Materiales Escritorio Y Suministros', valor: 45 }, { cuenta: 'Material Y Prod.Limpieza', valor: 119 }, { cuenta: 'Mantenimiento Y Repuestos', valor: 52 }, { cuenta: 'Horas Extras', valor: 2867 }, { cuenta: 'Gastos Medicos Y Capacitacion', valor: 277 }, { cuenta: 'Gastos legales y tributarios', valor: 351 }, { cuenta: 'Gastos Generales', valor: 413 }, { cuenta: 'Gastos De Alimentacion', valor: 1189 }, { cuenta: 'Envases', valor: 0 }, { cuenta: 'Depreciacion', valor: 33 }, { cuenta: 'Costo de Servicios Internos', valor: 4365 }, { cuenta: 'Costo Almacenaje Mat. Y Sum.', valor: 52 }, { cuenta: 'Cconectividad y comunicaciones', valor: 152 }, { cuenta: 'Beneficios Sociales', valor: 9067 }, { cuenta: 'Baja De Productos', valor: 329 },
            ],
            cuentasAlmacenamiento: [
                { cuenta: 'Sueldos Y Jornales', valor: 26015 }, { cuenta: 'Sistemas tecnologicos', valor: 1421 }, { cuenta: 'Servicios Externos', valor: 25449 }, { cuenta: 'Ropa De Trabajo', valor: 500 }, { cuenta: 'Pasajes Y Viaticos', valor: 61 }, { cuenta: 'Materiales Escritorio Y Suministros', valor: 2204 }, { cuenta: 'Material Y Prod.Limpieza', valor: 431 }, { cuenta: 'Mantenimiento Y Repuestos', valor: 5344 }, { cuenta: 'Horas Extras', valor: 4680 }, { cuenta: 'Gastos Medicos Y Capacitacion', valor: 527 }, { cuenta: 'Gastos legales y tributarios', valor: 496 }, { cuenta: 'Gastos Generales', valor: 1240 }, { cuenta: 'Gastos De Alimentacion', valor: 2048 }, { cuenta: 'Envases', valor: 0 }, { cuenta: 'Energia Electrica Y Agua', valor: 3763 }, { cuenta: 'Depreciacion', valor: 10619 }, { cuenta: 'Costo de Servicios Internos', valor: 2551 }, { cuenta: 'Costo Almacenaje Mat. Y Sum.', valor: 331 }, { cuenta: 'Cconectividad y comunicaciones', valor: 427 }, { cuenta: 'Beneficios Sociales', valor: 25109 }, { cuenta: 'Baja De Productos', valor: 2753 },
            ]
        };

        const datosSCZ = {
            logistica: [
                { mes: 'jul. 2024', transp_kg: 0.36, alm_kg: 0.12, transp_maple: 0.64, alm_maple: 0.20 }, { mes: 'ago. 2024', transp_kg: 0.37, alm_kg: 0.21, transp_maple: 0.66, alm_maple: 0.37 }, { mes: 'sep. 2024', transp_kg: 0.35, alm_kg: 0.19, transp_maple: 0.64, alm_maple: 0.34 }, { mes: 'oct. 2024', transp_kg: 0.41, alm_kg: 0.17, transp_maple: 0.74, alm_maple: 0.31 }, { mes: 'nov. 2024', transp_kg: 0.22, alm_kg: 0.12, transp_maple: 0.40, alm_maple: 0.21 }, { mes: 'dic. 2024', transp_kg: 0.35, alm_kg: 0.20, transp_maple: 0.64, alm_maple: 0.35 }, { mes: 'ene. 2025', transp_kg: 0.32, alm_kg: 0.19, transp_maple: 0.59, alm_maple: 0.34 }, { mes: 'feb. 2025', transp_kg: 0.33, alm_kg: 0.15, transp_maple: 0.61, alm_maple: 0.28 }, { mes: 'mar. 2025', transp_kg: 0.27, alm_kg: 0.20, transp_maple: 0.49, alm_maple: 0.36 }, { mes: 'abr. 2025', transp_kg: 0.31, alm_kg: 0.16, transp_maple: 0.56, alm_maple: 0.30 }, { mes: 'may. 2025', transp_kg: 0.27, alm_kg: 0.19, transp_maple: 0.47, alm_maple: 0.33 }, { mes: 'jun. 2025', transp_kg: 0.31, alm_kg: 0.21, transp_maple: 0.56, alm_maple: 0.38 },
            ],
            transporte: [
                { mes: 'jul. 2024', clientes: 16, cap_kg: 33, cap_maples: 61 }, { mes: 'ago. 2024', clientes: 16, cap_kg: 31, cap_maples: 58 }, { mes: 'sep. 2024', clientes: 18, cap_kg: 32, cap_maples: 63 }, { mes: 'oct. 2024', clientes: 22, cap_kg: 35, cap_maples: 60 }, { mes: 'nov. 2024', clientes: 19, cap_kg: 47, cap_maples: 80 }, { mes: 'dic. 2024', clientes: 21, cap_kg: 43, cap_maples: 82 }, { mes: 'ene. 2025', clientes: 21, cap_kg: 37, cap_maples: 70 }, { mes: 'feb. 2025', clientes: 21, cap_kg: 40, cap_maples: 78 }, { mes: 'mar. 2025', clientes: 18, cap_kg: 45, cap_maples: 90 }, { mes: 'abr. 2025', clientes: 18, cap_kg: 43, cap_maples: 85 }, { mes: 'may. 2025', clientes: 17, cap_kg: 47, cap_maples: 94 }, { mes: 'jun. 2025', clientes: 15, cap_kg: 52, cap_maples: 99 },
            ],
            canal: [
                { supracanal: 'OFF PREMISE', canal: 'ALMACEN', maples: 85572.80, dropsize_maple: 54.33, kilos: 153415.63, dropsize_kg: 97.41 }, { supracanal: 'OFF PREMISE', canal: 'DISTRIBUIDORES', maples: 186933.00, dropsize_maple: 1074.33, kilos: 324428.68, dropsize_kg: 1864.53 }, { supracanal: 'OFF PREMISE', canal: 'FARMACIA', maples: 6.80, dropsize_maple: 2.27, kilos: 11.73, dropsize_kg: 3.91 }, { supracanal: 'OFF PREMISE', canal: 'FRIALES', maples: 93266.00, dropsize_maple: 54.07, kilos: 169646.21, dropsize_kg: 98.35 }, { supracanal: 'OFF PREMISE', canal: 'HOGAR', maples: 2843.40, dropsize_maple: 10.98, kilos: 5790.66, dropsize_kg: 22.36 }, { supracanal: 'OFF PREMISE', canal: 'MAYORISTAS', maples: 45031.00, dropsize_maple: 158.56, kilos: 82483.27, dropsize_kg: 290.43 }, { supracanal: 'OFF PREMISE', canal: 'MICROMERCADOS', maples: 104264.00, dropsize_maple: 12.68, kilos: 187905.26, dropsize_kg: 22.85 }, { supracanal: 'OFF PREMISE', canal: 'PUESTO DE MERCADO', maples: 565461.60, dropsize_maple: 52.44, kilos: 1054657.90, dropsize_kg: 97.81 }, { supracanal: 'OFF PREMISE', canal: 'SUPERMERCADOS', maples: 129785.20, dropsize_maple: 50.54, kilos: 237070.23, dropsize_kg: 92.32 }, { supracanal: 'OFF PREMISE', canal: 'TIENDAS', maples: 152741.30, dropsize_maple: 9.74, kilos: 298708.95, dropsize_kg: 19.05 }, { supracanal: 'OFF PREMISE', canal: 'TIENDAS ESPECIALIZADA', maples: 11940.20, dropsize_maple: 40.89, kilos: 22106.99, dropsize_kg: 75.71 }, { supracanal: 'OFF PREMISE', canal: 'VETERINARIAS', maples: 790.00, dropsize_maple: 10.13, kilos: 1505.16, dropsize_kg: 19.30 }, { supracanal: 'ON PREMISE', canal: 'CHURRASQUERIAS', maples: 6841.00, dropsize_maple: 9.38, kilos: 13055.90, dropsize_kg: 17.91 }, { supracanal: 'ON PREMISE', canal: 'HAMBURGUESERIAS', maples: 4976.00, dropsize_maple: 8.46, kilos: 9566.56, dropsize_kg: 16.27 }, { supracanal: 'ON PREMISE', canal: 'INSTITUCIONES', maples: 69146.00, dropsize_maple: 25.55, kilos: 133478.62, dropsize_kg: 49.33 }, { supracanal: 'ON PREMISE', canal: 'PIZZERIAS', maples: 4526.00, dropsize_maple: 13.23, kilos: 8868.71, dropsize_kg: 25.93 }, { supracanal: 'ON PREMISE', canal: 'POLLERIAS', maples: 37667.00, dropsize_maple: 17.22, kilos: 79300.25, dropsize_kg: 36.24 }, { supracanal: 'ON PREMISE', canal: 'RECREATIVO', maples: 21094.00, dropsize_maple: 14.90, kilos: 40708.21, dropsize_kg: 28.75 }, { supracanal: 'ON PREMISE', canal: 'RESTAURANTES', maples: 43664.00, dropsize_maple: 11.01, kilos: 87946.71, dropsize_kg: 22.18 }, { supracanal: 'ON PREMISE', canal: 'VENTA AL PASO', maples: 33177.00, dropsize_maple: 41.11, kilos: 67479.40, dropsize_kg: 83.62 },
            ],
            simulacionAlmacenamiento: [
                { mes: 'jul-25', valor: 0.46 }, { mes: 'ago-25', valor: 0.48 }, { mes: 'sep-25', valor: 0.44 }, { mes: 'oct-25', valor: 0.40 }, { mes: 'nov-25', valor: 0.26 }, { mes: 'dic-25', valor: 0.45 }, { mes: 'ene-26', valor: 0.42 }, { mes: 'feb-26', valor: 0.36 }, { mes: 'mar-26', valor: 0.37 }, { mes: 'abr-26', valor: 0.38 }, { mes: 'may-26', valor: 0.39 }, { mes: 'jun-26', valor: 0.43 },
            ]
        };
        
        const datosLPZ = {
            logistica: [
                { mes: 'jul. 2024', transp_kg: 0.43, alm_kg: 0.18, transp_maple: 0.77, alm_maple: 0.32 }, { mes: 'ago. 2024', transp_kg: 0.53, alm_kg: 0.17, transp_maple: 0.95, alm_maple: 0.31 }, { mes: 'sep. 2024', transp_kg: 0.51, alm_kg: 0.20, transp_maple: 0.93, alm_maple: 0.37 }, { mes: 'oct. 2024', transp_kg: 0.51, alm_kg: 0.17, transp_maple: 0.93, alm_maple: 0.32 }, { mes: 'nov. 2024', transp_kg: 0.44, alm_kg: 0.14, transp_maple: 0.80, alm_maple: 0.26 }, { mes: 'dic. 2024', transp_kg: 0.55, alm_kg: 0.26, transp_maple: 1.03, alm_maple: 0.48 }, { mes: 'ene. 2025', transp_kg: 0.47, alm_kg: 0.14, transp_maple: 0.86, alm_maple: 0.27 }, { mes: 'feb. 2025', transp_kg: 0.49, alm_kg: 0.15, transp_maple: 0.93, alm_maple: 0.28 }, { mes: 'mar. 2025', transp_kg: 0.55, alm_kg: 0.25, transp_maple: 1.04, alm_maple: 0.48 }, { mes: 'abr. 2025', transp_kg: 0.49, alm_kg: 0.19, transp_maple: 0.92, alm_maple: 0.35 }, { mes: 'may. 2025', transp_kg: 0.46, alm_kg: 0.18, transp_maple: 0.85, alm_maple: 0.33 }, { mes: 'jun. 2025', transp_kg: 0.82, alm_kg: 0.84, transp_maple: 1.52, alm_maple: 1.56 },
            ],
            transporte: [
                { mes: 'jul. 2024', clientes: 20, cap_kg: 55, cap_maples_100: 78 }, { mes: 'ago. 2024', clientes: 22, cap_kg: 62, cap_maples_100: 86 }, { mes: 'sep. 2024', clientes: 22, cap_kg: 65, cap_maples_100: 90 }, { mes: 'oct. 2024', clientes: 21, cap_kg: 61, cap_maples_100: 85 }, { mes: 'nov. 2024', clientes: 21, cap_kg: 65, cap_maples_100: 88 }, { mes: 'dic. 2024', clientes: 22, cap_kg: 58, cap_maples_100: 79 }, { mes: 'ene. 2025', clientes: 22, cap_kg: 64, cap_maples_100: 87 }, { mes: 'feb. 2025', clientes: 22, cap_kg: 68, cap_maples_100: 92 }, { mes: 'mar. 2025', clientes: 19, cap_kg: 64, cap_maples_100: 86 }, { mes: 'abr. 2025', clientes: 19, cap_kg: 63, cap_maples_100: 86 }, { mes: 'may. 2025', clientes: 17, cap_kg: 75, cap_maples_100: 101 }, { mes: 'jun. 2025', clientes: 14, cap_kg: 76, cap_maples_100: 105 },
            ],
            canal: [
                { supracanal: 'OFF PREMISE', canal: 'ALMACEN', maples: 42589.00, dropsize_maple: 47.01, kilos: 79049.69, dropsize_kg: 87.25 }, { supracanal: 'OFF PREMISE', canal: 'DISTRIBUIDORES', maples: 238.00, dropsize_maple: 19.83, kilos: 638.36, dropsize_kg: 53.20 }, { supracanal: 'OFF PREMISE', canal: 'FARMACIA', maples: 0, dropsize_maple: 0, kilos: 0, dropsize_kg: 0 }, { supracanal: 'OFF PREMISE', canal: 'FRIALES', maples: 731558.80, dropsize_maple: 18.63, kilos: 1384187.09, dropsize_kg: 35.26 }, { supracanal: 'OFF PREMISE', canal: 'HOGAR', maples: 700.00, dropsize_maple: 11.29, kilos: 1431.72, dropsize_kg: 23.09 }, { supracanal: 'OFF PREMISE', canal: 'MAYORISTAS', maples: 119170.60, dropsize_maple: 208.71, kilos: 228626.11, dropsize_kg: 400.40 }, { supracanal: 'OFF PREMISE', canal: 'MICROMERCADOS', maples: 13544.60, dropsize_maple: 16.20, kilos: 25400.84, dropsize_kg: 30.38 }, { supracanal: 'OFF PREMISE', canal: 'PUESTO DE MERCADO', maples: 115964.60, dropsize_maple: 18.98, kilos: 217233.68, dropsize_kg: 35.55 }, { supracanal: 'OFF PREMISE', canal: 'SUPERMERCADOS', maples: 48906.40, dropsize_maple: 35.29, kilos: 89146.45, dropsize_kg: 64.32 }, { supracanal: 'OFF PREMISE', canal: 'TIENDAS', maples: 216798.20, dropsize_maple: 9.34, kilos: 411482.63, dropsize_kg: 17.72 }, { supracanal: 'OFF PREMISE', canal: 'TIENDAS ESPECIALIZADA', maples: 37343.00, dropsize_maple: 71.54, kilos: 68304.83, dropsize_kg: 130.85 }, { supracanal: 'OFF PREMISE', canal: 'VETERINARIAS', maples: 207.00, dropsize_maple: 8.28, kilos: 404.67, dropsize_kg: 16.19 }, { supracanal: 'ON PREMISE', canal: 'CHURRASQUERIAS', maples: 3032.00, dropsize_maple: 14.23, kilos: 5785.01, dropsize_kg: 27.16 }, { supracanal: 'ON PREMISE', canal: 'HAMBURGUESERIAS', maples: 1744.00, dropsize_maple: 6.92, kilos: 3244.85, dropsize_kg: 12.88 }, { supracanal: 'ON PREMISE', canal: 'INSTITUCIONES', maples: 16132.00, dropsize_maple: 16.07, kilos: 31455.29, dropsize_kg: 31.33 }, { supracanal: 'ON PREMISE', canal: 'PIZZERIAS', maples: 1110.00, dropsize_maple: 9.25, kilos: 2163.72, dropsize_kg: 18.03 }, { supracanal: 'ON PREMISE', canal: 'POLLERIAS', maples: 40259.00, dropsize_maple: 14.08, kilos: 78495.98, dropsize_kg: 27.46 }, { supracanal: 'ON PREMISE', canal: 'RECREATIVO', maples: 15195.00, dropsize_maple: 16.05, kilos: 29390.23, dropsize_kg: 31.04 }, { supracanal: 'ON PREMISE', canal: 'RESTAURANTES', maples: 73392.20, dropsize_maple: 10.82, kilos: 142118.34, dropsize_kg: 20.95 }, { supracanal: 'ON PREMISE', canal: 'VENTA AL PASO', maples: 29316.00, dropsize_maple: 11.73, kilos: 57308.69, dropsize_kg: 22.92 },
            ]
        };

        const datosCBBA = {
            logistica: [
                { mes: 'jul. 2024', transp_kg: 0.67, alm_kg: 0.41, transp_maple: 1.21, alm_maple: 0.74 }, { mes: 'ago. 2024', transp_kg: 0.72, alm_kg: 0.46, transp_maple: 1.31, alm_maple: 0.84 }, { mes: 'sep. 2024', transp_kg: 0.50, alm_kg: 0.50, transp_maple: 0.92, alm_maple: 0.92 }, { mes: 'oct. 2024', transp_kg: 0.88, alm_kg: 0.80, transp_maple: 1.63, alm_maple: 1.48 }, { mes: 'nov. 2024', transp_kg: 0.51, alm_kg: 0.55, transp_maple: 0.91, alm_maple: 0.99 }, { mes: 'dic. 2024', transp_kg: 0.76, alm_kg: 0.98, transp_maple: 1.41, alm_maple: 1.82 }, { mes: 'ene. 2025', transp_kg: 0.89, alm_kg: 0.78, transp_maple: 1.70, alm_maple: 1.49 }, { mes: 'feb. 2025', transp_kg: 0.84, alm_kg: 0.88, transp_maple: 1.59, alm_maple: 1.65 }, { mes: 'mar. 2025', transp_kg: 0.55, alm_kg: 1.03, transp_maple: 1.06, alm_maple: 1.97 }, { mes: 'abr. 2025', transp_kg: 0.45, alm_kg: 0.85, transp_maple: 0.87, alm_maple: 1.63 }, { mes: 'may. 2025', transp_kg: 0.58, alm_kg: 1.37, transp_maple: 1.10, alm_maple: 2.59 }, { mes: 'jun. 2025', transp_kg: 0.69, alm_kg: 1.74, transp_maple: 1.24, alm_maple: 3.12 },
            ],
             transporte: [
                { mes: 'jun. 2024', clientes: 12, cap_kg: 13.82, cap_maples_100: 22 }, { mes: 'jul. 2024', clientes: 15, cap_kg: 15.51, cap_maples_100: 25 }, { mes: 'ago. 2024', clientes: 17, cap_kg: 18.18, cap_maples_100: 29 }, { mes: 'sep. 2024', clientes: 18, cap_kg: 18.36, cap_maples_100: 29 }, { mes: 'oct. 2024', clientes: 16, cap_kg: 15.43, cap_maples_100: 24 }, { mes: 'nov. 2024', clientes: 18, cap_kg: 19.27, cap_maples_100: 31 }, { mes: 'dic. 2024', clientes: 15, cap_kg: 15.73, cap_maples_100: 27 }, { mes: 'ene. 2025', clientes: 17, cap_kg: 15.04, cap_maples_100: 26 }, { mes: 'feb. 2025', clientes: 18, cap_kg: 16.17, cap_maples_100: 27 }, { mes: 'mar. 2025', clientes: 16, cap_kg: 17.05, cap_maples_100: 27 }, { mes: 'abr. 2025', clientes: 13, cap_kg: 17.77, cap_maples_100: 29 }, { mes: 'may. 2025', clientes: 14, cap_kg: 22.62, cap_maples_100: 35 }, { mes: 'jun. 2025', clientes: 10, cap_kg: 22.15, cap_maples_100: 35 }, { mes: 'jul. 2025', clientes: 13, cap_kg: 20.85, cap_maples_100: 34 },
            ],
             canal: [
                { supracanal: 'OFF PREMISE', canal: 'ALMACEN', maples: 7438.00, dropsize_maple: 32.34, kilos: 13440.03, dropsize_kg: 58.43 }, { supracanal: 'OFF PREMISE', canal: 'DISTRIBUIDORES', maples: 238.00, dropsize_maple: 79.33, kilos: 465.59, dropsize_kg: 155.20 }, { supracanal: 'OFF PREMISE', canal: 'FARMACIA', maples: 91.00, dropsize_maple: 6.07, kilos: 177.83, dropsize_kg: 11.86 }, { supracanal: 'OFF PREMISE', canal: 'FRIALES', maples: 76687.20, dropsize_maple: 18.35, kilos: 158059.29, dropsize_kg: 37.82 }, { supracanal: 'OFF PREMISE', canal: 'HOGAR', maples: 451.00, dropsize_maple: 7.91, kilos: 863.77, dropsize_kg: 15.15 }, { supracanal: 'OFF PREMISE', canal: 'MAYORISTAS', maples: 0, dropsize_maple: 0, kilos: 0, dropsize_kg: 0 }, { supracanal: 'OFF PREMISE', canal: 'MICROMERCADOS', maples: 4688.00, dropsize_maple: 9.55, kilos: 9130.07, dropsize_kg: 18.59 }, { supracanal: 'OFF PREMISE', canal: 'PUESTO DE MERCADO', maples: 25205.00, dropsize_maple: 14.36, kilos: 52375.58, dropsize_kg: 29.84 }, { supracanal: 'OFF PREMISE', canal: 'SUPERMERCADOS', maples: 24792.40, dropsize_maple: 47.31, kilos: 45462.57, dropsize_kg: 86.76 }, { supracanal: 'OFF PREMISE', canal: 'TIENDAS', maples: 44987.20, dropsize_maple: 7.77, kilos: 91420.41, dropsize_kg: 15.80 }, { supracanal: 'OFF PREMISE', canal: 'TIENDAS ESPECIALIZADA', maples: 3268.20, dropsize_maple: 30.26, kilos: 6002.42, dropsize_kg: 55.58 }, { supracanal: 'OFF PREMISE', canal: 'VETERINARIAS', maples: 109.00, dropsize_maple: 9.08, kilos: 202.44, dropsize_kg: 16.87 }, { supracanal: 'ON PREMISE', canal: 'CHURRASQUERIAS', maples: 344.00, dropsize_maple: 7.32, kilos: 752.27, dropsize_kg: 16.01 }, { supracanal: 'ON PREMISE', canal: 'HAMBURGUESERIAS', maples: 10.00, dropsize_maple: 5.00, kilos: 21.30, dropsize_kg: 10.65 }, { supracanal: 'ON PREMISE', canal: 'INSTITUCIONES', maples: 3157.80, dropsize_maple: 14.76, kilos: 6531.29, dropsize_kg: 30.52 }, { supracanal: 'ON PREMISE', canal: 'PIZZERIAS', maples: 137.00, dropsize_maple: 5.27, kilos: 273.46, dropsize_kg: 10.52 }, { supracanal: 'ON PREMISE', canal: 'POLLERIAS', maples: 5829.00, dropsize_maple: 16.28, kilos: 11065.83, dropsize_kg: 30.91 }, { supracanal: 'ON PREMISE', canal: 'RECREATIVO', maples: 1523.00, dropsize_maple: 10.65, kilos: 2955.67, dropsize_kg: 20.67 }, { supracanal: 'ON PREMISE', canal: 'RESTAURANTES', maples: 8994.40, dropsize_maple: 13.99, kilos: 18855.77, dropsize_kg: 29.32 }, { supracanal: 'ON PREMISE', canal: 'VENTA AL PASO', maples: 17095.00, dropsize_maple: 34.89, kilos: 34590.82, dropsize_kg: 70.59 },
            ]
        };

        // --- 2. TEMAS DE COLOR ---
        const themes = {
            nacional: { text: 'text-red-800', head: 'bg-red-100', total: 'bg-red-50', border: 'border-red-200', chart: { bar: 'rgba(239, 68, 68, 0.6)', line: 'rgba(153, 27, 27, 0.8)' } },
            scz: { text: 'text-green-800', head: 'bg-green-100', total: 'bg-green-50', border: 'border-green-200' },
            lpz: { text: 'text-rose-800', head: 'bg-rose-100', total: 'bg-rose-50', border: 'border-rose-200' },
            cbba: { text: 'text-blue-800', head: 'bg-blue-100', total: 'bg-blue-50', border: 'border-blue-200' }
        };

        // --- 3. FUNCIONES DE RENDERIZADO ---
        const createKpiTable = (containerId, data, unit, theme) => {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const transpKey = `transp_${unit}`;
            const almKey = `alm_${unit}`;
            
            const calculateAverage = (arr) => {
                if (!arr || arr.length === 0) return '0.00';
                const sum = arr.reduce((acc, val) => acc + val, 0);
                return (sum / arr.length).toFixed(2);
            };

            const transportValues = data.map(d => d[transpKey]);
            const storageValues = data.map(d => d[almKey]);
            const totalValues = data.map(d => d[transpKey] + d[almKey]);

            const avgTransport = calculateAverage(transportValues);
            const avgStorage = calculateAverage(storageValues);
            const avgTotal = calculateAverage(totalValues);

            const monthsHeader = data.map(d => `<th class="p-3 text-sm font-semibold tracking-wide text-left">${d.mes}</th>`).join('');
            const transportCosts = transportValues.map(val => `<td class="p-3 text-sm text-gray-700 whitespace-nowrap">${val.toFixed(2)}</td>`).join('');
            const storageCosts = storageValues.map(val => `<td class="p-3 text-sm text-gray-700 whitespace-nowrap">${val.toFixed(2)}</td>`).join('');
            const totalCosts = totalValues.map(val => `<td class="p-3 text-sm font-bold text-gray-900 whitespace-nowrap">${val.toFixed(2)}</td>`).join('');
            
            const tableHTML = `
                <table class="w-full kpi-table">
                    <thead class="${theme.head}">
                        <tr>
                            <th class="p-3 text-sm font-semibold tracking-wide text-left sticky left-0 ${theme.head} z-10">Concepto</th>
                            ${monthsHeader}
                            <th class="p-3 text-sm font-semibold tracking-wide text-left sticky right-0 ${theme.head} z-10 border-l ${theme.border}">Promedio</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y ${theme.border.replace('border-', 'divide-')}">
                        <tr class="kpi-details-row bg-white hover:bg-gray-50 transition-colors duration-200">
                            <td class="p-3 text-sm text-gray-700 font-medium sticky left-0 bg-white z-10">Costo Transporte</td>
                            ${transportCosts}
                            <td class="p-3 text-sm text-gray-800 font-bold whitespace-nowrap sticky right-0 bg-white z-10 border-l ${theme.border}">${avgTransport}</td>
                        </tr>
                        <tr class="kpi-details-row bg-white hover:bg-gray-50 transition-colors duration-200">
                            <td class="p-3 text-sm text-gray-700 font-medium sticky left-0 bg-white z-10">Costo Almacenamiento</td>
                            ${storageCosts}
                            <td class="p-3 text-sm text-gray-800 font-bold whitespace-nowrap sticky right-0 bg-white z-10 border-l ${theme.border}">${avgStorage}</td>
                        </tr>
                        <tr class="${theme.total} hover:${theme.head.replace('bg-','bg-')} transition-colors duration-200">
                            <td class="p-3 text-sm ${theme.text} font-bold sticky left-0 ${theme.total} z-10">Costo Logístico Total</td>
                            ${totalCosts}
                            <td class="p-3 text-sm ${theme.text} font-bold whitespace-nowrap sticky right-0 ${theme.total} z-10 border-l ${theme.border}">${avgTotal}</td>
                        </tr>
                    </tbody>
                </table>`;
            container.innerHTML = tableHTML;
        };

        const createTransportTable = (containerId, data, theme, concepts) => {
            const container = document.getElementById(containerId);
            if (!container) return;

            const calculateAverage = (arr, isInt = false) => {
                if (!arr || arr.length === 0) return isInt ? '0' : '0.00';
                const sum = arr.reduce((acc, val) => acc + val, 0);
                const avg = sum / arr.length;
                return isInt ? Math.round(avg).toString() : avg.toFixed(2);
            };

            const monthsHeader = data.map(d => `<th class="p-3 text-sm font-semibold tracking-wide text-left">${d.mes}</th>`).join('');
            
            let rowsHTML = '';
            for (const concept of concepts) {
                const values = data.map(d => d[concept.key]);
                const avg = calculateAverage(values, concept.isInt);
                const cells = values.map(val => `<td class="p-3 text-sm text-gray-700 whitespace-nowrap">${typeof val === 'number' && !concept.isInt ? val.toFixed(2) : val}${concept.unit || ''}</td>`).join('');
                rowsHTML += `
                    <tr class="bg-white hover:bg-gray-50 transition-colors duration-200">
                        <td class="p-3 text-sm text-gray-700 font-medium sticky left-0 bg-white z-10">${concept.label}</td>
                        ${cells}
                        <td class="p-3 text-sm text-gray-800 font-bold whitespace-nowrap sticky right-0 bg-white z-10 border-l ${theme.border}">${avg}${concept.unit || ''}</td>
                    </tr>
                `;
            }

            const tableHTML = `
                <table class="w-full kpi-table">
                    <thead class="${theme.head}">
                        <tr>
                            <th class="p-3 text-sm font-semibold tracking-wide text-left sticky left-0 ${theme.head} z-10">Concepto</th>
                            ${monthsHeader}
                            <th class="p-3 text-sm font-semibold tracking-wide text-left sticky right-0 ${theme.head} z-10 border-l ${theme.border}">Promedio</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y ${theme.border.replace('border-', 'divide-')}">
                        ${rowsHTML}
                    </tbody>
                </table>`;
            container.innerHTML = tableHTML;
        };

        const createCanalTable = (containerId, data, theme) => {
            const container = document.getElementById(containerId);
            if (!container) return;

            const formatNumber = (num, decimals = 2) => {
                if (num === 0 || !num) return '-';
                return num.toLocaleString('es-BO', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
            };
            
            let rowsHTML = '';
            const groupedData = data.reduce((acc, item) => {
                acc[item.supracanal] = acc[item.supracanal] || [];
                acc[item.supracanal].push(item);
                return acc;
            }, {});

            for (const supracanal in groupedData) {
                rowsHTML += `
                    <tr class="${theme.total}">
                        <td colspan="5" class="p-3 text-sm ${theme.text} font-bold sticky left-0 ${theme.total} z-10">${supracanal}</td>
                    </tr>
                `;
                const groupItems = groupedData[supracanal];
                groupItems.forEach(item => {
                    rowsHTML += `
                        <tr class="bg-white hover:bg-gray-50 transition-colors duration-200">
                            <td class="p-3 text-sm text-gray-700 font-medium sticky left-0 bg-white z-10">${item.canal}</td>
                            <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${formatNumber(item.maples)}</td>
                            <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${formatNumber(item.dropsize_maple)}</td>
                            <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${formatNumber(item.kilos)}</td>
                            <td class="p-3 text-sm text-gray-700 whitespace-nowrap text-right">${formatNumber(item.dropsize_kg)}</td>
                        </tr>
                    `;
                });
            }

            const tableHTML = `
                <table class="w-full kpi-table">
                    <thead class="${theme.head}">
                        <tr>
                            <th class="p-3 text-sm font-semibold tracking-wide text-left sticky left-0 ${theme.head} z-10">Canal</th>
                            <th class="p-3 text-sm font-semibold tracking-wide text-right">Maples</th>
                            <th class="p-3 text-sm font-semibold tracking-wide text-right">Dropsize Maple</th>
                            <th class="p-3 text-sm font-semibold tracking-wide text-right">Kilos</th>
                            <th class="p-3 text-sm font-semibold tracking-wide text-right">Dropsize KG</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y ${theme.border.replace('border-', 'divide-')}">
                        ${rowsHTML}
                    </tbody>
                </table>`;
            container.innerHTML = tableHTML;
        };
        
        const createParetoChart = (canvasId, data, theme, useLogScale = false, customTooltipCallback = null) => {
            const container = document.getElementById(canvasId);
            if (!container) return;
            const sortedData = data.sort((a, b) => b.valor - a.valor);
            const labels = sortedData.map(d => d.cuenta);
            const values = sortedData.map(d => d.valor);
            const total = values.reduce((sum, value) => sum + value, 0);
            let cumulative = 0;
            const cumulativePercentage = values.map(value => {
                cumulative += value;
                return total > 0 ? (cumulative / total) * 100 : 0;
            });

            new Chart(container.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Costo por Cuenta', data: values, backgroundColor: theme.chart.bar, borderColor: theme.chart.bar.replace('0.6', '1'), borderWidth: 1, yAxisID: 'y' },
                        { label: 'Porcentaje Acumulado', data: cumulativePercentage, type: 'line', backgroundColor: theme.chart.line, borderColor: theme.chart.line.replace('0.8', '1'), yAxisID: 'y1' }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    scales: {
                        x: { ticks: { autoSkip: false, maxRotation: 90, minRotation: 45 } },
                        y: { type: useLogScale ? 'logarithmic' : 'linear', display: true, position: 'left', title: { display: true, text: useLogScale ? 'Costo Total (Bs) - Escala Logarítmica' : 'Costo Total (Bs)' } },
                        y1: { type: 'linear', display: true, position: 'right', min: 0, max: 100, title: { display: true, text: 'Porcentaje Acumulado (%)' }, grid: { drawOnChartArea: false }, ticks: { callback: value => value.toFixed(2) + '%' } }
                    },
                    plugins: { tooltip: { mode: 'index', intersect: false, callbacks: customTooltipCallback || { label: (context) => `${context.dataset.label}: ${context.dataset.yAxisID === 'y1' ? context.parsed.y.toFixed(2) + '%' : context.parsed.y.toLocaleString('es-BO')}` } } }
                }
            });
        };

        const createSimulationChart = (canvasId, realData, simData, theme) => {
            const container = document.getElementById(canvasId);
            if (!container) return;
            Chart.register(ChartDataLabels);

            const labels = ['Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic', 'Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'];
            const realValues = realData.map(d => d.alm_kg);
            const simValues = simData.map(d => d.valor);

            new Chart(container.getContext('2d'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Costo Real 2024-2025 (Bs/Kg)',
                            data: realValues,
                            borderColor: theme.chart.bar.replace('0.6', '1'),
                            backgroundColor: theme.chart.bar.replace('0.6', '1'),
                            tension: 0.1
                        },
                        {
                            label: 'Costo Simulación 2025-2026 (Bs/Kg)',
                            data: simValues,
                            borderColor: 'rgba(107, 114, 128, 1)',
                            backgroundColor: 'rgba(107, 114, 128, 1)',
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Costo (Bs/Kg)'
                            }
                        }
                    },
                    plugins: {
                        datalabels: {
                            align: 'top',
                            formatter: (value, context) => {
                                if (context.datasetIndex === 1) { // Simulation data
                                    const realValue = realValues[context.dataIndex];
                                    const diff = value - realValue;
                                    const sign = diff >= 0 ? '+' : '-';
                                    return `${value.toFixed(2)}\n(Gap: ${sign}${Math.abs(diff).toFixed(2)})`;
                                }
                                return value.toFixed(2);
                            },
                             font: {
                                weight: 'bold'
                            },
                            color: (context) => context.dataset.borderColor
                        },
                        title: {
                            display: true,
                            text: 'Comparación Costo Almacenamiento: Real vs. Simulación',
                            font: {
                                size: 18
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        };

        // --- 4. LÓGICA DE LA APLICACIÓN ---
        window.onload = () => {
            // Renderizado inicial
            createKpiTable('table-container-kg-nacional', datosNacional.logistica, 'kg', themes.nacional);
            createKpiTable('table-container-maple-nacional', datosNacional.logistica, 'maple', themes.nacional);
            createKpiTable('table-container-kg-scz', datosSCZ.logistica, 'kg', themes.scz);
            createKpiTable('table-container-maple-scz', datosSCZ.logistica, 'maple', themes.scz);
            createKpiTable('table-container-kg-lpz', datosLPZ.logistica, 'kg', themes.lpz);
            createKpiTable('table-container-maple-lpz', datosLPZ.logistica, 'maple', themes.lpz);
            createKpiTable('table-container-kg-cbba', datosCBBA.logistica, 'kg', themes.cbba);
            createKpiTable('table-container-maple-cbba', datosCBBA.logistica, 'maple', themes.cbba);
            
            const conceptsSCZ = [
                { key: 'clientes', label: 'Clientes por Camión', isInt: true },
                { key: 'cap_kg', label: 'Capacidad en KG (%)', unit: '%' },
                { key: 'cap_maples', label: 'Uso de Cap. en Maples (%)', unit: '%' }
            ];
            createTransportTable('table-container-transporte-scz', datosSCZ.transporte, themes.scz, conceptsSCZ);

            const conceptsLPZ = [
                { key: 'clientes', label: 'Clientes por Camión', isInt: true },
                { key: 'cap_kg', label: 'Capacidad en KG (%)', unit: '%' },
                { key: 'cap_maples_100', label: 'Capacidad en Maples al 100% (%)', unit: '%' }
            ];
            createTransportTable('table-container-transporte-lpz', datosLPZ.transporte, themes.lpz, conceptsLPZ);
            
            const conceptsCBBA = [
                { key: 'clientes', label: 'Clientes por Camión', isInt: true },
                { key: 'cap_kg', label: 'Capacidad en KG (%)', unit: '%' },
                { key: 'cap_maples_100', label: 'Capacidad en Maples al 100% (%)', unit: '%' }
            ];
            createTransportTable('table-container-transporte-cbba', datosCBBA.transporte, themes.cbba, conceptsCBBA);

            createCanalTable('table-container-canal-lpz', datosLPZ.canal, themes.lpz);
            createCanalTable('table-container-canal-scz', datosSCZ.canal, themes.scz);
            createCanalTable('table-container-canal-cbba', datosCBBA.canal, themes.cbba);
            
            const transporteTooltip = { label: (c) => { 
                if(c.dataset.yAxisID === 'y1') return `${c.dataset.label}: ${c.parsed.y.toFixed(2)}%`; 
                let l = `${c.dataset.label}: ${c.parsed.y.toLocaleString('es-BO')}`; 
                if (c.label === 'Sueldos Y Jornales') return [l, '  - 1 Empleado Huevo SCZ', '  - 2 Empleados Huevo LPZ'];
                if (c.label === 'Seguros Gral, Fletes De Producto') return [l, '  - SANTA CRUZ PROMEDIO: 60,480', '  - LA PAZ PROMEDIO: 85,100', '  - COCHABAMBA: 17,716'];
                return l; 
            } };
            const almacenamientoTooltipNacional = { label: (c) => { if(c.dataset.yAxisID === 'y1') return `${c.dataset.label}: ${c.parsed.y.toFixed(2)}%`; let l = `${c.dataset.label}: ${c.parsed.y.toLocaleString('es-BO')}`; if (c.label === 'Sueldos Y Jornales') return [l, '  - 2 EMPLEADOS HUEVO CBBA', '  - 1 EMPLEADO HUEVO LPZ', '  - 3 EMPLEADOS HUEVO SCZ']; return l; } };
            
            createParetoChart('paretoChartTransporte', datosNacional.cuentasTransporte, themes.nacional, true, transporteTooltip);
            createParetoChart('paretoChartAlmacenamiento', datosNacional.cuentasAlmacenamiento, themes.nacional, false, almacenamientoTooltipNacional);
            createSimulationChart('simulationChartScz', datosSCZ.logistica, datosSCZ.simulacionAlmacenamiento, themes.scz);
            
            // Lógica de pestañas
            const tabs = document.querySelectorAll('.tab-button');
            const views = document.querySelectorAll('.view-container');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => {
                        t.classList.remove('active', 'border-red-500', 'text-red-600', 'border-green-500', 'text-green-600', 'border-rose-500', 'text-rose-600', 'border-blue-500', 'text-blue-600');
                        t.classList.add('border-transparent', 'text-gray-500');
                    });
                    
                    let themeColor = 'red';
                    if (tab.id === 'tab-scz') themeColor = 'green';
                    if (tab.id === 'tab-lpz') themeColor = 'rose';
                    if (tab.id === 'tab-cbba') themeColor = 'blue';

                    tab.classList.add('active', `border-${themeColor}-500`, `text-${themeColor}-600`);
                    tab.classList.remove('border-transparent', 'text-gray-500');

                    const viewId = tab.dataset.view;
                    views.forEach(view => {
                        view.classList.toggle('hidden', view.id !== viewId);
                    });
                });
            });

            // Lógica del botón de ocultar
            document.getElementById('toggle-all-button').addEventListener('click', (e) => {
                const activeView = document.querySelector('.view-container:not(.hidden)');
                if (activeView) {
                    const detailRows = activeView.querySelectorAll('.kpi-details-row');
                    const areHidden = Array.from(detailRows).some(row => row.classList.contains('hidden'));
                    detailRows.forEach(row => row.classList.toggle('hidden', !areHidden));
                    e.target.textContent = areHidden ? 'Mostrar Detalles' : 'Mostrar Detalles';
                }
            });
        };
    </script>
</body>
</html>
